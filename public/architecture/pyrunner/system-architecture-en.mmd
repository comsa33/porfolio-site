flowchart TB
    subgraph Client[Client Layer]
        IDE[PyEditor<br/>Code Writing]
        AdminUI[Admin UI<br/>Scenario Editor]
        External[External App<br/>Agent API Call]
    end
    
    subgraph AgentSystem[Agent System]
        AgentServer[Agent Server<br/>Custom API Wrapper<br/>Dynamic Sub-Apps]
        Orchestrator[Agent Orchestrator<br/>Scenario Execution]
    end
    
    subgraph PyRuntime[Python Runtime Environment]
        DevServer[Dev Server<br/>Validation/Playground<br/>NFS Shared]
        SandboxServer[Sandbox Server<br/>Production Deploy<br/>Actual Logic Execution]
    end
    
    subgraph Storage[Storage]
        NFS[NFS Shared Storage<br/>PyEditor ↔ Dev Bridge]
        Redis[Redis<br/>Distributed Lock]
    end
    
    AdminUI -->|1. Create Agent| AgentServer
    AgentServer -->|2. Generate Custom API<br/>Dynamic Sub-Apps| AgentSystem
    
    IDE -->|3. Write Python Code| NFS
    NFS -->|4. Share Code| DevServer
    DevServer -->|5. Validate/Test| IDE
    
    AdminUI -->|6. Deploy Scenario| DevServer
    DevServer -->|7. Dev → Sandbox Deploy| SandboxServer
    
    Orchestrator -->|8. Call Agent API| AgentServer
    External -->|8. Call Agent API| AgentServer
    
    AgentServer -->|9. Call Python Function| SandboxServer
    SandboxServer -->|10. Execution Result| AgentServer
    
    DevServer -.->|Lock| Redis
    SandboxServer -.->|Lock| Redis
    
    style AgentServer fill:#4f46e5,stroke:#818cf8,color:#fff
    style DevServer fill:#0891b2,stroke:#06b6d4,color:#fff
    style SandboxServer fill:#059669,stroke:#10b981,color:#fff
    style Orchestrator fill:#7c3aed,stroke:#a78bfa,color:#fff
    style NFS fill:#f59e0b,stroke:#fbbf24,color:#fff
