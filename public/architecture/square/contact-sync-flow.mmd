sequenceDiagram
    participant ğŸ“± as í´ë¼ì´ì–¸íŠ¸
    participant ğŸ” as SHA-256 í•´ì‹±
    participant â˜ï¸ as Cloud Functions
    participant ğŸ—‚ï¸ as phoneHashes
    participant ğŸ“Š as Firestore

    ğŸ“±->>ğŸ“±: ì—°ë½ì²˜ ì •ê·œí™” (E.164)
    ğŸ“±->>ğŸ”: ì „í™”ë²ˆí˜¸ í•´ì‹± ìš”ì²­
    ğŸ”-->>ğŸ“±: SHA-256 í•´ì‹œ ë°˜í™˜
    
    Note over ğŸ“±: ì›ë³¸ ì „í™”ë²ˆí˜¸ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ë§Œ ì¡´ì¬
    
    ğŸ“±->>â˜ï¸: syncContacts(í•´ì‹œ ë°°ì—´)
    
    loop ê° í•´ì‹œì— ëŒ€í•´
        â˜ï¸->>ğŸ—‚ï¸: ì—­ì¸ë±ìŠ¤ ì¡°íšŒ
        ğŸ—‚ï¸-->>â˜ï¸: ë§¤ì¹­ userId ë°˜í™˜
        
        alt ë§¤ì¹­ëœ ì‚¬ìš©ì ì¡´ì¬
            â˜ï¸->>ğŸ“Š: ì‚¬ìš©ì ì„¤ì • í™•ì¸
            
            alt allowPhoneSearch = true
                â˜ï¸->>ğŸ“Š: contactFriends ì—…ë°ì´íŠ¸
            end
        end
    end
    
    â˜ï¸-->>ğŸ“±: ë™ê¸°í™” ê²°ê³¼ ë°˜í™˜
    
    Note over ğŸ—‚ï¸: Firestore Rules:<br/>allow read, write: if false<br/>(í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨)
