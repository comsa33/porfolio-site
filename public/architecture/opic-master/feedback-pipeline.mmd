graph TB
    subgraph "Client Layer"
        A[음성 녹음<br/>MediaRecorder]
        A1[재생/일시정지]
        A2[녹음 시간 표시]
    end
    
    subgraph "Audio Processing"
        B[MP3 인코딩<br/>lamejs]
        B1[Blob 생성]
        B2[Base64 변환]
    end
    
    subgraph "API Layer"
        C["/api/analyze"]
        C1[크레딧 차감]
        C2[사용 로그 기록]
    end
    
    subgraph "AI Analysis"
        D[Gemini 3.5 Flash<br/>multimodal]
        D1[STT 변환]
        D2[문법/어휘 분석]
        D3[발음/유창성 평가]
        D4[모범 답안 생성]
    end
    
    subgraph "Feedback Rendering"
        E[InlineCorrection<br/>인라인 문법 교정]
        E1[SuggestionList<br/>카테고리별 피드백]
        E2[StructuredModelAnswer<br/>템플릿 매핑]
        E3[ScoreGrid<br/>5개 영역 점수]
    end
    
    subgraph "Data Storage"
        F[(PostgreSQL<br/>Prisma)]
        F1[(IndexedDB<br/>로컬 녹음)]
    end
    
    A --> B
    A1 --> A
    A2 --> A
    
    B --> B1
    B1 --> B2
    B2 --> C
    
    C --> C1
    C --> C2
    C1 --> D
    
    D --> D1
    D --> D2
    D --> D3
    D --> D4
    
    D1 --> E
    D2 --> E
    D3 --> E1
    D4 --> E2
    
    E --> E3
    E1 --> E3
    E2 --> E3
    
    C2 --> F
    B1 --> F1
    
    style A fill:#e1f5ff,stroke:#333,stroke-width:2px,color:#000
    style B fill:#fff9c4,stroke:#333,stroke-width:2px,color:#000
    style C fill:#f3e5f5,stroke:#333,stroke-width:2px,color:#000
    style D fill:#e8f5e9,stroke:#333,stroke-width:2px,color:#000
    style E fill:#ffebee,stroke:#333,stroke-width:2px,color:#000
    style F fill:#ffe0b2,stroke:#333,stroke-width:2px,color:#000
